<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>考勤卡</title>
    <link rel="stylesheet" href="/css/time-card.css">
</head>
<body>
    <div class="layui-card title">
        <div class="layui-card-header name" id="title"></div>
        <button class="layui-btn layui-btn-primary" onclick="history.go(-1)">返回</button>
    </div>
    
    <div id="time-card-list"></div>

</body>
<script type="text/html" id="time-card">

  {{# for (const year of d) { }}

    <div class="layui-card">
      <div class="layui-card-header">{{ year }}年</div>
      <div class="layui-card-body">
          <table class="layui-table calendar-table">
              <colgroup>
                <col width="100">
                <col width="100">
                <col width="100">
                <col width="100">
                <col width="100">
                <col width="100">
                <col width="100">
                <col width="100">
                <col width="100">
                <col width="100">
                <col width="100">
                <col width="100">
                <col width="100">
                <col width="100">
              </colgroup>
              <thead>
                <tr>
                  <th>考勤</th>
                  <th date="2019-01">1月</th>
                  <th date="2019-02">2月</th>
                  <th date="2019-03">3月</th>
                  <th date="2019-04">4月</th>
                  <th date="2019-05">5月</th>
                  <th date="2019-06">6月</th>
                  <th date="2019-07">7月</th>
                  <th date="2019-08">8月</th>
                  <th date="2019-09">9月</th>
                  <th date="2019-10">10月</th>
                  <th date="2019-11">11月</th>
                  <th date="2019-12">12月</th>
                  <th>合计</th>
                </tr> 
              </thead>
              <tbody>
                <tr>
                  <td>工日</td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                </tr>
                <tr>
                  <td>工时</td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                  <td><input type="number" class="layui-disabled" readonly="readonly"></td>
                </tr>
                <tr>
                  <td>工价</td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td></td>
                </tr>
                <tr>
                  <td>支款</td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td></td>
                </tr>
                <tr>
                  <td>应发工资</td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td></td>
                </tr>
                <tr>
                  <td>实发工资</td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td><input type="number"></td>
                  <td></td>
                </tr>
              </tbody>
          </table>
      </div>
    </div>

  {{# } }}
    
  
</script>
<script type="text/html" id="calendar-month">
  <table class="layui-table calendar-table-day">
    <thead>
      <tr>
        <th>星期日</th>
        <th>星期一</th>
        <th>星期二</th>
        <th>星期三</th>
        <th>星期四</th>
        <th>星期五</th>
        <th>星期六</th>
      </tr> 
    </thead>
    <tbody>

      {{# for(var i = 0;i < 36;i ++){ }}
        {{#
          var remainder = i % 7;
          var dayOfWeek;
          if(remainder == 0){
            dayOfWeek = '星期日';
          }else if(remainder == 1){
            dayOfWeek = '星期一';
          }else if(remainder == 2){
            dayOfWeek = '星期二';
          }else if(remainder == 3){
            dayOfWeek = '星期三';
          }else if(remainder == 4){
            dayOfWeek = '星期四';
          }else if(remainder == 5){
            dayOfWeek = '星期五';
          }else if(remainder == 6){
            dayOfWeek = '星期六';
          }
        }}
        {{# if(d.calendar[d.index] != undefined){ }}
          {{# if(i != 0 && remainder == 0){ }}
            </tr>
          {{# } }}
          {{# if(remainder == 0){ }}
            <tr>
          {{# } }}
          {{# if(d.calendar[d.index].dayOfWeek == dayOfWeek){ }}
              <td>
                <div>
                  <span>{{ d.calendar[d.index].dd }}</span>
                  <input type="number" min="0" max="24">
                </div>
              </td>
              {{# d.index ++; }}
          {{# }else{ }}
              <td></td>
          {{# } }}
        {{# } }}
        {{# if(d.index == d.calendar.length){ }}
          </tr>
          {{# d.index ++ }}
        {{# } }}
      {{# } }}

    </tbody>
  </table>
</script>
<script src="/js/config.js"></script>
<script src="/js/common.js"></script>
<script src="/js/jquery-3.4.1.min.js"></script>
<script src="/layui/layui.js"></script>
<script>

  layui.use(['layer','laytpl'], function(){
    var layer = layui.layer; 
    var laytpl = layui.laytpl;
    var projectName = getParamFromUrl("projectName");
    var employeeName = getParamFromUrl("employeeName");
    var employeeType = getParamFromUrl("employeeType");
    $('#title').text(employeeName + ' - ' + employeeType + ' - ' + projectName);

    render();
    var date = new Date();
    var year = date.getFullYear();
    console.log(year);

    function render(){
      // var data;
      // data.list = ['2019','2020'];
      var tpl = $('#time-card').html();
      laytpl(tpl).render(['2019','2020','2021'],function(html){
        $('#time-card-list').html(html);
      });
    }

    $('.calendar-table thead th').on('click',function(e){
      var date = $(this).attr('date');
      if(date != undefined){
        // console.log(date);
        $.ajax({
          url: baseUrl + '/sidan/finance/attendance/calendar',
          type: 'get',
          data: {
            year: date.split('-')[0],
            month: date.split('-')[1]
          },
          dataType: 'json',
          success: function(json){
            if(json.code == 0){
              var tpl = $('#calendar-month').html();
              json.index = 0;
              laytpl(tpl).render(json, function(html){
                layer.closeAll();
                layer.open({
                  type: 1,
                  title: date,
                  shadeClose: true,
                  shade: false,
                  resize: false,
                  area: '700px',
                  content: html
                });
              });

            }else{
              console.log(josn.msg);
            }
          }
        })
      }
    });
  });


</script>
</html>